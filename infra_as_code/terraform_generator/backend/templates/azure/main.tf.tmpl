{{- range $module := .Modules }}
module "{{ $module.ModuleName }}" {
  source = "{{ $module.Source }}"
  {{- range $varName, $varDef := $module.Variables }}
  {{ $varName }} = {{ $varDef.Value }}
  {{- end }}
  {{- if $module.DependsOn }}
  depends_on = [
    {{- $deps := $module.DependsOn }}
    {{- $depsLen := len $deps }}
    {{- range $index, $dependency := $deps }}
    module.{{ $dependency }}{{ if lt (add $index 1) $depsLen }},{{ end }}
    {{- end }}
  ]
  {{- end }}
}
{{ end }}